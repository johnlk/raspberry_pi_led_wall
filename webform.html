<!DOCTYPE html>
<html>
<head>
  <title>Raspberry Pi LED Wall</title>
  <style>
    body { font-family: verdana, sans-serif; }
    #selectorContainer, #buttonContainer { display: inline; padding: 5px; }
    #messageContainer textarea { width: 300px; height: 150px; font-size: 21px; font-family: verdana, sans-serif; padding: 10px; } 
    #messageContainer { margin-bottom: 10px; }
    #button { font-size: 14px; font-family: verdana, sans-serif; }
  </style>
  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.27.0.js"></script>
  <script>
    var pubnub = new PubNub({
      subscribeKey: "sub-c-41e1caba-e89a-11e6-81cc-0619f8945a4f",
      publishKey: "pub-c-09b3dfc7-fbb3-4f80-8e8d-1e1c1afe58e8",
      ssl: true
    });
  </script>
</head>
<body>
  <span>Select a text color:</span>
  <div id="selectorContainer">
    <input type="color" id="text_color" name="text_color" value="#0066ff">
  </div>
  <br>
  <p>Write your message: (140 chars max)</p>
  <div id="messageContainer">
    <textarea id="message" maxlength="140" placeholder="john you're so cool"></textarea>
  </div>
  <span>Post message:</span>
  <div id="buttonContainer">
    <button id="button">Let's do it</button>
  </div>
  <script>
    var color = document.getElementById('text_color');
    var message = document.getElementById('message');
    var button = document.getElementById('button');

    function toRGB(hexString){
      if(hexString.length != "7"){
        return { r: 0, g: 0, b: 255 };
      }
      var r = parseInt(hexString.substring(1, 3), 16);
      var g = parseInt(hexString.substring(3, 5), 16);
      var b = parseInt(hexString.substring(5, 7), 16);
      return { r: r, g: g, b: b };
    }

    button.addEventListener('click', function(){
      var selectedColor = color.value;
      var text = message.value;

      if(text == ''){
        alert('please write a message');
        return;
      }

      var payload = {
        color: toRGB(selectedColor),
        text: text
      };

      pubnub.publish(
        {
          message: payload,
          channel: 'ledWall',
          sendByPost: false,
          storeInHistory: false
        },
        function (status, response) {
          if (status.error) {
            alert('There was an error sending the message. If it keeps happening, let john know');
            console.log(status);
          } else {
            alert('Success');
            message.value = "";
            console.log("message sent w/ timetoken", response.timetoken)
          }
        }
      );

    });
  </script>
</body>
</html>
